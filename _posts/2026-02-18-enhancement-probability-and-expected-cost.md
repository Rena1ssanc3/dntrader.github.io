---
layout: post
title: "强化概率与期望公式推导"
date: 2026-02-18
categories: guide
---

## 强化概率总览

强化系统分为两个阶段：1-6级为安全阶段（100%成功），7-15级为风险阶段（成功率递减）。使用强化保护药后，失败不会销毁装备，但可能降级或无事发生。

| 强化等级 | 成功率 | 失败时消失概率 | 失败时降级概率 | 降级等级数 |
|---------|--------|--------------|--------------|-----------|
| 1-6 | 100% | - | - | - |
| 7 | 45% | 100% | - | - |
| 8 | 40% | 50% | 50% | 1 |
| 9 | 35% | 50% | 50% | 2 |
| 10 | 30% | 100% | - | - |
| 11 | 25% | - | 100% | 1 |
| 12 | 20% | - | 100% | 2 |
| 13 | 15% | - | 100% | 2 |
| 14 | 5% | - | 100% | 2 |
| 15 | 1% | - | 100% | 2 |

- **消失**：强化失败，装备留在当前等级，素材消耗但无其他惩罚。
- **降级**：强化失败，装备等级下降。降级等级数 K 表示装备会等概率降到 n-1, n-2, ..., n-K 中的某一级。

## 每次强化素材消耗

| 强化等级 | 生命精髓 | 高级钻石 | 强化保护药 |
|---------|---------|---------|-----------|
| 1-6 | 3 | 1 | 0 |
| 7-11 | 4 | 2 | 18 |
| 12-15 | 5 | 3 | 18 |

## 期望公式推导

### 定义

设 $C[n]$ 为从 0 级强化到 n 级的**期望总素材消耗**。

尝试从 n-1 级强化到 n 级时：
- 成功概率 $p$，失败概率 $f = 1 - p$
- 失败时消失概率 $P_d$（装备留在 n-1 级）
- 失败时降级概率 $P_g$（装备等概率降到 n-1 ~ n-K 级之一）

### 推导过程

每次尝试强化到 n 级，消耗 $\text{base}[n]$ 的素材，然后：

$$C[n] = C[n-1] + \text{base}[n] + f \cdot \left[ P_d \cdot (C[n] - C[n-1]) + \frac{P_g}{K} \sum_{i=1}^{K} (C[n] - C[n-i]) \right]$$

含义：成功则花费 $C[n-1] + \text{base}[n]$；失败消失则需从 n-1 重新来过；失败降级则需从降级后的等级重新来过。

展开并整理 $C[n]$：

$$C[n] \cdot \left[1 - f \cdot (P_d + P_g)\right] = C[n-1] \cdot \left[1 - f \cdot P_d\right] + \text{base}[n] - f \cdot \frac{P_g}{K} \sum_{i=1}^{K} C[n-i]$$

注意到 $P_d + P_g = 1$（失败时必定消失或降级），因此 $1 - f \cdot (P_d + P_g) = 1 - f = p$。

化简得到最终递推公式：

$$C[n] = \frac{C[n-1] + \text{base}[n] + f \cdot \frac{P_g}{K} \cdot \sum_{i=1}^{K} C[n-i]}{p}$$

从 $C[0] = 0$ 开始，逐级迭代即可求出每一级的期望消耗。

### 计算示例

以强化 9 级为例（成功率 35%，失败率 65%，消失 50%，降级 50%，K=2）：

$$C[9] = \frac{C[8] + \text{base}[9] + 0.65 \times \frac{0.5}{2} \times (C[8] + C[7])}{0.35}$$

## 期望素材消耗表（从 0 级到目标等级）

以下为计算结果，表示从 0 级强化到对应等级的期望素材总消耗：

| 目标等级 | 生命精髓 | 高级钻石 | 强化保护药 |
|---------|---------|---------|-----------|
| 1 | 3 | 1 | 0 |
| 2 | 6 | 2 | 0 |
| 3 | 9 | 3 | 0 |
| 4 | 12 | 4 | 0 |
| 5 | 15 | 5 | 0 |
| 6 | 18 | 6 | 0 |
| 7 | 26.89 | 10.44 | 40 |
| 8 | 43.56 | 18.78 | 115 |
| 9 | 74.59 | 34.29 | 254.64 |
| 10 | 87.92 | 40.96 | 314.64 |
| 11 | 143.92 | 68.96 | 566.64 |
| 12 | 419.59 | 209.29 | 1,784.64 |
| 13 | 2,173.70 | 1,103.85 | 9,520.64 |
| 14 | 38,220.64 | 19,493.57 | 168,435.64 |
| 15 | 3,694,196.64 | 1,884,656.57 | 16,285,752.64 |

## 期望花费（龙币与金币）

基于龙币价格（高级钻石 50、生命精髓 40、强化保护药 20），换算期望花费（不含每次强化操作本身的金币费用，仅计算素材成本）：

<label>金价：1元 = <input type="number" id="goldRate2" value="25" style="width:60px"> 金币</label>

<div style="overflow-x:auto">
<table>
<thead><tr><th>目标等级</th><th>龙币</th><th>金币</th><th>月卡数</th><th>官方收入(元)</th></tr></thead>
<tbody id="costTable"></tbody>
</table>
</div>

<script>
var dragonData = [170,340,510,680,850,1020,2397.6,4981.4,9790.9,11857.6,20537.6,62940.9,332553.3,5872216.9,567715746.9];
function calcCost(){
  var r=parseFloat(document.getElementById('goldRate2').value)||0;
  var rate=r>0?9000/(30*r):0;
  var tb=document.getElementById('costTable');
  tb.innerHTML='';
  dragonData.forEach(function(d,i){
    var tr=document.createElement('tr');
    var g=rate>0?(d/rate):0;
    var mc=d/9000;
    var rmb=mc*30;
    tr.innerHTML='<td>'+(i+1)+'</td><td>'+d.toLocaleString()+'</td><td>'+(g>0?g.toFixed(2):'-')+'</td><td>'+mc.toFixed(2)+'</td><td>'+rmb.toFixed(2)+'</td>';
    tb.appendChild(tr);
  });
}
document.getElementById('goldRate2').addEventListener('input',calcCost);
calcCost();
</script>

可以看到，强化等级越高，期望花费呈指数级增长。14 级期望花费约 39 万金，15 级则飙升至约 3785 万金——这解释了为什么高强装备在市场上价值极高。
